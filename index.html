<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fessions Word Cloud</title>
<style>
  body {
    background: #111;
    color: #eee;
    font-family: 'Inter', sans-serif;
    overflow: hidden;
  }

  #wordCloud {
    width: 100%;
    height: 100vh;
  }

  .modal {
    display: none;
    position: fixed;
    z-index: 10;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    justify-content: center;
    align-items: center;
  }

  .modal-content {
    background: #fff;
    color: #222;
    padding: 2rem;
    border-radius: 12px;
    max-width: 600px;
    text-align: center;
    position: relative;
  }

  .modal-content p {
    font-size: 1.2rem;
    margin-bottom: 1.5rem;
  }

  .modal-buttons {
    display: flex;
    justify-content: center;
    gap: 1rem;
  }

  button {
    background: #222;
    color: #fff;
    border: none;
    padding: 0.6rem 1.2rem;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  button:hover {
    background: #444;
  }

  #closeBtn {
    background: #900;
  }

  #closeBtn:hover {
    background: #c00;
  }
</style>
</head>
<body>
<canvas id="wordCloud"></canvas>

<div class="modal" id="modal">
  <div class="modal-content" id="modalContent">
    <p id="noteText"></p>
    <div class="modal-buttons">
      <button id="prevBtn">⬅ Back</button>
      <button id="nextBtn">Next ➡</button>
      <button id="closeBtn">✖ Close</button>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/wordcloud@1.2.2/src/wordcloud2.js"></script>
<script>
// === CONFIG ===
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSrNxHSKHvTW7SN6dBA0aRL2ekckHnWC2m4qp7WoOhrecea5E2l5crGJGrJxEBjRPTeSOMLSReNNmrv/pub?gid=413092187&single=true&output=csv"; // <-- Replace with your Google Sheet CSV link

let entries = [];
let currentIndex = 0;

const moodColors = {
  vent: "#e74c3c",
  rant: "#c0392b",
  release: "#3498db",
  confess: "#8e44ad",
  reflect: "#2ecc71",
  celebrate: "#f1c40f",
  default: "#bdc3c7"
};

// === LOAD DATA ===
Papa.parse(csvUrl, {
  download: true,
  header: true,
  complete: function(results) {
    entries = results.data.filter(row => row.Message && row.Message.trim() !== "");
    const words = entries.map(e => [e.Message.slice(0, 25), Math.random() * 10 + 10]);
    WordCloud(document.getElementById('wordCloud'), {
      list: words,
      gridSize: 8,
      weightFactor: 3,
      fontFamily: 'Inter, sans-serif',
      color: '#eee',
      backgroundColor: '#111',
      click: function(item) {
        const match = entries.find(e => e.Message.startsWith(item[0]));
        if (match) {
          currentIndex = entries.indexOf(match);
          showModal(match);
        }
      },
      hover: function(item, dimension, event) {
        event.target.style.cursor = item ? 'pointer' : 'default';
      }
    });
  }
});

// === MODAL LOGIC ===
const modal = document.getElementById('modal');
const noteText = document.getElementById('noteText');
const modalContent = document.getElementById('modalContent');

document.getElementById('closeBtn').onclick = () => modal.style.display = 'none';
document.getElementById('prevBtn').onclick = () => showNote(-1);
document.getElementById('nextBtn').onclick = () => showNote(1);

function showModal(entry) {
  const mood = entry.Mood?.toLowerCase() || 'default';
  modalContent.style.background = moodColors[mood] || moodColors.default;
  noteText.innerText = entry.Message || "(No message)";
  modal.style.display = 'flex';
}

function showNote(direction) {
  currentIndex = (currentIndex + direction + entries.length) % entries.length;
  showModal(entries[currentIndex]);
}
</script>
</body>
</html>
