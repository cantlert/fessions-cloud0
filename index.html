<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fessions Word Cloud</title>
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <script src="https://cdn.jsdelivr.net/npm/d3-cloud@1/build/d3.layout.cloud.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #fafafa;
      margin: 0;
    }
    #wordCloud {
      width: 90vw;
      height: 90vh;
    }
  </style>
</head>
<body>
  <div id="wordCloud"></div>
  
  <script>
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSrNxHSKHvTW7SN6dBA0aRL2ekckHnWC2m4qp7WoOhrecea5E2l5crGJGrJxEBjRPTeSOMLSReNNmrv/pub?gid=413092187&single=true&output=csv"; // published CSV link from Google Sheets

    async function loadData() {
      const response = await fetch(csvUrl);
      const data = await response.text();
      const rows = data.split("\n").slice(1); // skip header row

      const words = rows
        .map(row => {
          const cols = row.split(",");
          return cols[3]; // Message column
        })
        .filter(Boolean)
        .join(" ")
        .split(/\s+/);

      const wordCounts = {};
      words.forEach(word => {
        word = word.replace(/[^a-zA-Z0-9]/g, "").toLowerCase();
        if (word.length > 2) {
          wordCounts[word] = (wordCounts[word] || 0) + 1;
        }
      });

      const wordData = Object.keys(wordCounts).map(word => ({
        text: word,
        size: 10 + wordCounts[word] * 5
      }));

      renderCloud(wordData);
    }

    function renderCloud(words) {
      const width = document.getElementById("wordCloud").clientWidth;
      const height = document.getElementById("wordCloud").clientHeight;

      const layout = d3.layout.cloud()
        .size([width, height])
        .words(words)
        .padding(5)
        .rotate(() => ~~(Math.random() * 2) * 90)
        .font("Impact")
        .fontSize(d => d.size)
        .on("end", draw);

      layout.start();

      function draw(words) {
        d3.select("#wordCloud")
          .append("svg")
          .attr("width", width)
          .attr("height", height)
          .append("g")
          .attr("transform", `translate(${width / 2},${height / 2})`)
          .selectAll("text")
          .data(words)
          .enter()
          .append("text")
          .style("font-size", d => `${d.size}px`)
          .style("fill", () => d3.schemeCategory10[Math.floor(Math.random() * 10)])
          .attr("text-anchor", "middle")
          .attr("transform", d => `translate(${[d.x, d.y]})rotate(${d.rotate})`)
          .text(d => d.text);
      }
    }

    loadData();
  </script>
</body>
</html>
